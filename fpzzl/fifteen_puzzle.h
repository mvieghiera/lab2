#ifndef FIFTEEN_PUZZLE_H
#define FIFTEEN_PUZZLE_H

#include <iostream>
#include <vector>

/**
 * @class FifteenPuzzle
 * @brief Класс, реализующий игру "Пятнашки" (15-puzzle).
 *
 * Класс предоставляет функциональность для игры в "Пятнашки": создание игрового поля,
 * перемещение клеток, проверка решения, работа с потоками ввода/вывода.
 * Размер игрового поля фиксирован - 4x4 клетки.
 */
class FifteenPuzzle {
private:
    static const int SIZE = 4;       ///< Размер игрового поля (4x4)
    int board[SIZE][SIZE];           ///< Игровое поле 4x4, 0 обозначает пустую клетку
    int emptyRow;                    ///< Текущая строка пустой клетки
    int emptyCol;                    ///< Текущий столбец пустой клетки

    /**
     * @brief Инициализирует игровое поле в решенном состоянии.
     *
     * Заполняет поле числами от 1 до 15 в порядке возрастания слева направо,
     * сверху вниз. Последняя клетка (правый нижний угол) становится пустой (0).
     */
    void initializeBoard();

    /**
     * @brief Перемешивает клетки на игровом поле случайным образом.
     *
     * Использует алгоритм случайной перестановки для создания начальной
     * конфигурации игры. Гарантирует, что все числа от 0 до 15 присутствуют
     * ровно один раз.
     */
    void shuffleBoard();

    /**
     * @brief Проверяет, является ли ход допустимым.
     * @param row Строка клетки, которую пытаются переместить
     * @param col Столбец клетки, которую пытаются переместить
     * @return true если ход допустим (клетка соседствует с пустой клеткой),
     *         false в противном случае
     */
    bool isValidMove(int row, int col) const;

public:
    /**
     * @brief Конструктор по умолчанию.
     *
     * Создает игровое поле, инициализирует его в решенном состоянии,
     * а затем перемешивает клетки случайным образом.
     */
    FifteenPuzzle();

    /**
     * @brief Конструктор копирования.
     * @param other Объект для копирования
     */
    FifteenPuzzle(const FifteenPuzzle& other);

    /**
     * @brief Деструктор (используется стандартный).
     */
    ~FifteenPuzzle() = default;

    /**
     * @brief Оператор присваивания.
     * @param other Объект для копирования
     * @return Ссылка на текущий объект
     */
    FifteenPuzzle& operator=(const FifteenPuzzle& other);

    /**
     * @brief Оператор сравнения на равенство.
     * @param other Объект для сравнения
     * @return true если игровые поля идентичны, false в противном случае
     */
    bool operator==(const FifteenPuzzle& other) const;

    /**
     * @brief Оператор сравнения на неравенство.
     * @param other Объект для сравнения
     * @return true если игровые поля различаются, false в противном случае
     */
    bool operator!=(const FifteenPuzzle& other) const;

    /**
     * @brief Оператор доступа к клетке игрового поля.
     * @param position Пара (строка, столбец) для доступа
     * @return Ссылка на значение в указанной клетке
     * @throw std::out_of_range если позиция выходит за пределы поля
     */
    int& operator[](std::pair<int, int> position);

    /**
     * @brief Константный оператор доступа к клетке игрового поля.
     * @param position Пара (строка, столбец) для доступа
     * @return Константная ссылка на значение в указанной клетке
     * @throw std::out_of_range если позиция выходит за пределы поля
     */
    const int& operator[](std::pair<int, int> position) const;

    /**
     * @brief Оператор вывода в поток.
     * @param os Поток вывода
     * @param puzzle Объект для вывода
     * @return Поток вывода
     *
     * Выводит игровое поле в формате 4 строки по 4 числа, разделенных пробелами.
     */
    friend std::ostream& operator<<(std::ostream& os, const FifteenPuzzle& puzzle);

    /**
     * @brief Оператор ввода из потока.
     * @param is Поток ввода
     * @param puzzle Объект для заполнения
     * @return Поток ввода
     *
     * Читает 16 чисел из потока и заполняет ими игровое поле.
     * Должно быть считано ровно 16 чисел, включая 0 для пустой клетки.
     */
    friend std::istream& operator>>(std::istream& is, FifteenPuzzle& puzzle);

    /**
     * @brief Перемещает клетку на пустое место.
     * @param row Строка перемещаемой клетки
     * @param col Столбец перемещаемой клетки
     * @return true если ход выполнен успешно, false если ход недопустим
     */
    bool move(int row, int col);

    /**
     * @brief Проверяет, решена ли головоломка.
     * @return true если головоломка решена, false в противном случае
     *
     * Головоломка считается решенной, если числа расположены в порядке
     * возрастания слева направо, сверху вниз, а пустая клетка находится
     * в правом нижнем углу.
     */
    bool isSolved() const;

    /**
     * @brief Сбрасывает игровое поле в решенное состояние.
     *
     * Устанавливает поле в состояние, когда головоломка решена
     * (числа от 1 до 15 по порядку, 0 в правом нижнем углу).
     */
    void reset();

    /**
     * @brief Выводит игровое поле в консоль в удобном формате.
     *
     * Пустая клетка отображается как пробелы, числа выравниваются.
     * Используется для отладки и демонстрации состояния игры.
     */
    void printBoard() const;

    /**
     * @brief Возвращает строку пустой клетки.
     * @return Номер строки пустой клетки (от 0 до 3)
     */
    int getEmptyRow() const { return emptyRow; }

    /**
     * @brief Возвращает столбец пустой клетки.
     * @return Номер столбца пустой клетки (от 0 до 3)
     */
    int getEmptyCol() const { return emptyCol; }
};

#endif // FIFTEEN_PUZZLE_H